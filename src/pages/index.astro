---
import Layout from '../layouts/Layout.astro';
import { skills } from '@/data/skills';
import { profile } from '@/data/profile';
import { projects } from '@/data/projects';
import profileImage from '@/assets/mola1129.png';

// 期間を計算する関数
function calculateDuration(period: string): string {
	const parts = period.split(' - ');
	if (parts.length !== 2) return '';

	const parseDate = (dateStr: string): Date => {
		if (dateStr === '現在') {
			return new Date();
		}
		const [year, month] = dateStr.split('/').map(Number);
		return new Date(year, month - 1);
	};

	const startDate = parseDate(parts[0]);
	const endDate = parseDate(parts[1]);

	let years = endDate.getFullYear() - startDate.getFullYear();
	let months = endDate.getMonth() - startDate.getMonth();

	if (months < 0) {
		years--;
		months += 12;
	}

	const result = [];
	if (years > 0) result.push(`${years}年`);
	if (months > 0) result.push(`${months}ヶ月`);

	return result.length > 0 ? `(${result.join('')})` : '';
}
---

<Layout>
	<main class="min-h-screen bg-white dark:bg-slate-950 py-12 px-4 md:px-8">
		<div class="max-w-5xl mx-auto">
			<div class="grid grid-cols-1 md:grid-cols-[280px_1fr] gap-8">
				<!-- 左カラム: サイドバー -->
				<aside class="space-y-6">
					<!-- 写真 -->
					<div class="flex justify-center md:justify-start">
						<img
							src={profileImage.src}
							alt={profile.name}
							class="w-40 h-40 rounded-full object-cover border-2 border-slate-300 dark:border-slate-700"
							width={160}
							height={160}
						/>
					</div>

					<!-- 名前・役職 -->
					<div class="text-center md:text-left">
						<h1 class="text-2xl md:text-3xl font-bold text-slate-900 dark:text-slate-50 mb-2">
							{profile.name}
						</h1>
						<p class="text-base md:text-lg text-slate-700 dark:text-slate-300">
							{profile.title}
						</p>
					</div>

					<!-- 連絡先 -->
					<div>
						<h2 class="text-xs font-semibold text-slate-900 dark:text-slate-50 mb-3 uppercase tracking-wide">
							Contact
						</h2>
						<div class="space-y-2">
							{profile.contacts.map((contact) => (
								<a
									href={contact.url}
									target="_blank"
									rel="noopener noreferrer"
									class="flex items-center gap-2 text-sm md:text-base text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 transition-colors"
								>
									{contact.icon === 'mail' ? (
										<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
											<path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
										</svg>
									) : contact.icon && (
										<img
											src={`https://skillicons.dev/icons?i=${contact.icon}`}
											alt={contact.type}
											class="w-5 h-5 object-contain shrink-0"
											loading="lazy"
										/>
									)}
									<span class="break-all">{contact.type}</span>
								</a>
							))}
						</div>
					</div>
				</aside>

				<!-- 右カラム: メインコンテンツ -->
				<main class="space-y-10">
					<!-- Career Summary -->
					<section>
						<h2 class="text-xl md:text-2xl font-bold text-slate-900 dark:text-slate-50 mb-4 pb-2 border-b-2 border-slate-900 dark:border-slate-100">
							Career Summary
						</h2>
						<p class="text-base text-slate-700 dark:text-slate-300 leading-relaxed">
							{profile.summary}
						</p>
					</section>

					<!-- Project Experience -->
					<section>
						<h2 class="text-xl md:text-2xl font-bold text-slate-900 dark:text-slate-50 mb-4 pb-2 border-b-2 border-slate-900 dark:border-slate-100">
							Project Experience
						</h2>
						<div class="space-y-8">
							{projects.map((project, index) => {
								const isOngoing = project.period.includes('現在');
								const isLast = index === projects.length - 1;
								return (
									<div class="relative pl-8">
										<!-- タイムライン縦線（ドットからカード下部まで、最後以外は次のドットまで） -->
										<div class={`absolute left-[5px] top-[8px] bottom-0 w-px bg-slate-300 dark:bg-slate-700 ${!isLast ? '-mb-8' : ''}`}></div>

										<!-- タイムラインドット（縦線の上に中心配置） -->
										<div class={`absolute left-0 top-[8px] w-2.5 h-2.5 rounded-full ring-4 ring-white dark:ring-slate-950 ${isOngoing ? 'bg-blue-500 dark:bg-blue-400' : 'bg-slate-900 dark:bg-slate-100'}`}></div>

										<!-- 期間表示 -->
										<div class="text-sm md:text-base font-semibold text-slate-600 dark:text-slate-400 mb-3">
											{project.period}
											<span class="ml-2 font-normal text-slate-500 dark:text-slate-500">
												{calculateDuration(project.period)}
											</span>
										</div>

										<!-- プロジェクトカード -->
										<div class="bg-slate-50 dark:bg-slate-900 rounded-lg p-6 border border-slate-200 dark:border-slate-800">
											<!-- プロジェクト名とタイプアイコン -->
											<div class="flex items-start gap-3 mb-4">
												<!-- タイプアイコン -->
												<div class="shrink-0 w-14 h-14 rounded-lg bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-800 dark:to-slate-700 flex items-center justify-center">
													{project.type === 'web' && (
														<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-slate-700 dark:text-slate-300">
															<path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418" />
														</svg>
													)}
													{project.type === 'mobile' && (
														<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-slate-700 dark:text-slate-300">
															<path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
														</svg>
													)}
													{project.type === 'infrastructure' && (
														<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-slate-700 dark:text-slate-300">
															<path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" />
														</svg>
													)}
													{project.type === 'data' && (
														<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-slate-700 dark:text-slate-300">
															<path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
														</svg>
													)}
												</div>

												<div class="flex-1">
													<h3 class="text-lg md:text-xl font-bold text-slate-900 dark:text-slate-50 mb-1">
														{project.name}
													</h3>
													{project.company && (
														<p class="text-sm md:text-base text-slate-600 dark:text-slate-400">
															{project.company} / {project.role}
														</p>
													)}
												</div>
											</div>

											<p class="text-base text-slate-700 dark:text-slate-300 mb-5 leading-relaxed">
												{project.description}
											</p>

											<div class="mb-5">
												<h4 class="text-sm md:text-base font-semibold text-slate-600 dark:text-slate-400 mb-2 uppercase tracking-wide">
													使用技術
												</h4>
												<div class="flex flex-wrap gap-2">
													{project.technologies.map((tech) => (
														<span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 hover:bg-slate-50 dark:hover:bg-slate-900 transition-colors">
															<img
																src={`https://skillicons.dev/icons?i=${tech.icon}`}
																alt={tech.name}
																class="w-4 h-4 object-contain shrink-0"
																loading="lazy"
															/>
															<span class="text-sm md:text-base font-medium text-slate-700 dark:text-slate-300">{tech.name}</span>
														</span>
													))}
												</div>
											</div>

											{project.achievements && project.achievements.length > 0 && (
												<div>
													<h4 class="text-sm md:text-base font-semibold text-slate-600 dark:text-slate-400 mb-2 uppercase tracking-wide">
														成果・実績
													</h4>
													<ul class="space-y-1.5 text-sm md:text-base text-slate-700 dark:text-slate-300">
														{project.achievements.map((achievement) => (
															<li class="flex gap-2">
																<span class="text-slate-400 dark:text-slate-600 shrink-0">▸</span>
																<span>{achievement}</span>
															</li>
														))}
													</ul>
												</div>
											)}
										</div>
									</div>
								);
							})}
						</div>
					</section>

					<!-- Skills -->
					<section>
						<h2 class="text-xl md:text-2xl font-bold text-slate-900 dark:text-slate-50 mb-4 pb-2 border-b-2 border-slate-900 dark:border-slate-100">
							Skills
						</h2>
						<div class="space-y-5">
							{skills.map((category) => (
								<div>
									<div class="mb-2">
										<h3 class="text-base md:text-lg font-semibold text-slate-900 dark:text-slate-50">
											{category.category}
										</h3>
										<p class="text-sm md:text-base text-slate-600 dark:text-slate-400">
											{category.description}
										</p>
									</div>
									<div class="flex flex-wrap gap-2">
										{category.items.map((skill) => (
											<a
												href={skill.url}
												target="_blank"
												rel="noopener noreferrer"
												class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 hover:bg-slate-50 dark:hover:bg-slate-900 transition-colors"
											>
												<img
													src={`https://skillicons.dev/icons?i=${skill.icon}`}
													alt={skill.name}
													class="w-4 h-4 object-contain shrink-0"
													loading="lazy"
												/>
												<span class="text-sm md:text-base font-medium text-slate-700 dark:text-slate-300">{skill.name}</span>
											</a>
										))}
									</div>
								</div>
							))}
						</div>
					</section>
				</main>
			</div>
		</div>
	</main>
</Layout>
